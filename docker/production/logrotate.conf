# Logrotate configuration for KuroPanel V2 Production
# Manages log rotation for application, web server, and system logs

# Apache logs
/var/log/kuropanel/apache_*.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    create 644 www-data www-data
    sharedscripts
    postrotate
        if [ -f /var/run/apache2/apache2.pid ]; then
            /usr/sbin/apache2ctl graceful > /dev/null 2>&1 || true
        fi
    endscript
}

# PHP error logs
/var/log/kuropanel/php_*.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    create 644 www-data www-data
    copytruncate
}

# Application logs
/var/www/html/writable/logs/*.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    create 644 www-data www-data
    copytruncate
}

# Supervisor logs
/var/log/supervisor/*.log {
    daily
    missingok
    rotate 14
    compress
    delaycompress
    notifempty
    create 644 root root
    postrotate
        /usr/bin/supervisorctl reread > /dev/null 2>&1 || true
        /usr/bin/supervisorctl reload > /dev/null 2>&1 || true
    endscript
}

# System logs
/var/log/kuropanel/system.log {
    weekly
    missingok
    rotate 8
    compress
    delaycompress
    notifempty
    create 644 root root
    copytruncate
}

# OPCache logs
/var/log/kuropanel/opcache_*.log {
    weekly
    missingok
    rotate 8
    compress
    delaycompress
    notifempty
    create 644 www-data www-data
    copytruncate
}
